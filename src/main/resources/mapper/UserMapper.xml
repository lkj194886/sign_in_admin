<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sign_in.code.mapper.UserMapper">
    <resultMap id="UserResultMap" type="com.sign_in.code.entity.SignInUser">
        <id column="user_id" jdbcType="INTEGER" property="userId"/>
        <result column="user_name" jdbcType="VARCHAR" property="userName"/>
        <result column="user_vip_id" property="userVipId"/>
        <result column="user_remaining_sum" property="userRemainingSum"/>
        <result column="user_qibi" property="userQiBi"/>
        <result column="user_invitation_id" property="userInvitationId"/>
        <result column="user_invitation_code" jdbcType="VARCHAR" property="userInvitationCode"/>
        <result column="user_zhifubao" property="userZhiFUBao"/>
        <result column="user_zhifubao_name" property="userZhiFUBaoName"/>
        <result column="user_weixin" property="userWeiXin"/>
        <result column="user_weixin_name" property="userWeiXinName"/>
        <result column="user_partner_id" property="userPartnerId"/>
        <association property="signInVip" resultMap="VipResultMap"/>
    </resultMap>


    <resultMap id="VipResultMap" type="com.sign_in.code.entity.SignInVip">
        <id column="vip_id" property="vipId"/>
        <result column="vip_name" property="vipName"/>
        <result column="vip_exchange_rate" property="vipExchangeRate"/>
    </resultMap>

    <sql id="Base_Column_List">
        user_id,
        user_name,
        user_vip_id,
        user_remaining_sum,
        user_qibi,
        user_invitation_id,
        user_invitation_code,
        user_zhifubao,
        user_zhifubao_name,
        user_weixin,
        user_partner_id,
        user_weixin_name
    </sql>

    <sql id="Base_Vip_List">
        vip_id,
        vip_name,
        vip_exchange_rate
    </sql>

    <insert id="addUser">
    INSERT INTO
    `sign_in_user`
    (
    `user_name`,
    `user_vip_id`,
    `user_remaining_sum`,
    `user_qibi`,
    `user_invitation_id`,
    `user_invitation_code`
    )
    VALUES
	(
	#{userName},
	#{userVipId},
	#{userRemainingSum},
	#{userQiBi},
	#{userInvitationId},
	#{userInvitationCode})
    </insert>

    <select id="getUser" resultMap="UserResultMap">
        SELECT
	       <include refid="Base_Column_List"/>,
	       <include refid="Base_Vip_List"/>
        FROM
        sign_in_user su
        INNER JOIN sign_in_vip sv ON sv.vip_id=su.user_vip_id
        WHERE
        su.user_name = #{phone}
    </select>
    <select id="getUserId" resultMap="UserResultMap">
        SELECT
        <include refid="Base_Column_List"/>,
        <include refid="Base_Vip_List"/>
        FROM
        sign_in_user su
        INNER JOIN sign_in_vip sv ON sv.vip_id=su.user_vip_id
        WHERE
        su.user_id = #{userInvitationId}
    </select>


</mapper>